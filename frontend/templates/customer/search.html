{% extends 'base.html' %}
{% block title %}Search Available Rooms{% endblock %}

{% block content %}
<h2>üîç Search Available Rooms</h2>

{% if error %}
<div class="alert alert-danger">{{ error }}</div>
{% endif %}

<form method="GET" class="row g-3 mb-4">
    <div class="col-md-3">
        <label class="form-label">Check-in Date</label>
        <input type="date" class="form-control" name="checkin" value="{{ checkin }}" required>
    </div>
    <div class="col-md-3">
        <label class="form-label">Check-out Date</label>
        <input type="date" class="form-control" name="checkout" value="{{ checkout }}" required>
    </div>
    <div class="col-md-2">
        <label class="form-label">Room Capacity</label>
        <select class="form-select" name="capacity">
            <option value="">Any</option>
            {% for cap in ['single', 'double', 'triple', 'family', 'suite'] %}
                <option value="{{ cap }}" {% if request.args.capacity == cap %}selected{% endif %}>{{ cap.capitalize() }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="col-md-2">
        <label class="form-label">Hotel Area</label>
        <input type="text" class="form-control" name="area" placeholder="e.g. Seattle" value="{{ request.args.area }}">
    </div>
    <div class="col-md-2">
        <label class="form-label">Hotel Chain</label>
        <input type="text" class="form-control" name="chain" placeholder="e.g. Marriott" value="{{ request.args.chain }}">
    </div>
    <div class="col-md-2">
        <label class="form-label">Category</label>
        <select class="form-select" name="category">
            <option value="">Any</option>
            {% for cat in ['Luxury', 'Resort', 'Boutique'] %}
                <option value="{{ cat }}" {% if request.args.category == cat %}selected{% endif %}>{{ cat }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="col-md-2">
        <label class="form-label">Max Price ($)</label>
        <input type="number" class="form-control" name="price" value="{{ request.args.price }}">
    </div>
    <div class="col-md-2">
        <label class="form-label">Min # Rooms</label>
        <input type="number" class="form-control" name="minrooms" value="{{ request.args.minrooms }}">
    </div>
    <div class="col-md-12 text-end">
        <button type="submit" class="btn btn-primary">Search</button>
    </div>
</form>

{% if rooms %}
<h4>Results:</h4>
<table class="table table-striped table-bordered">
    <thead class="table-light">
        <tr>
            <th>Hotel</th>
            <th>Chain</th>
            <th>Address</th>
            <th>Capacity</th>
            <th>View</th>
            <th>Extendable</th>
            <th>Price ($)</th>
            <th>Rating</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        {% for room in rooms %}
        <tr>
            <td>{{ room.hotelname }}</td>
            <td>{{ room.chainname }}</td>
            <td>{{ room.address }}</td>
            <td>{{ room.capacity }}</td>
            <td>{{ room.viewtype.replace('_', ' ').capitalize() }}</td>
            <td>{{ 'Yes' if room.extendable else 'No' }}</td>
            <td>{{ room.price }}</td>
            <td>{{ room.rating }}</td>
            <td>
                <form method="POST" action="{{ url_for('main.book_room') }}">
                    <input type="hidden" name="room_id" value="{{ room.roomid }}">
                    <input type="hidden" name="hotel_id" value="{{ room.hotelid }}">
                    <input type="hidden" name="checkin" value="{{ checkin }}">
                    <input type="hidden" name="checkout" value="{{ checkout }}">
                    <button class="btn btn-success btn-sm" type="submit">Book</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% elif checkin and checkout %}
<div class="alert alert-warning">No rooms match your criteria.</div>
{% endif %}
{% endblock %}
